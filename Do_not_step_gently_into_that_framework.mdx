---
title: 'Do not step gently into that framework'
date: '2025-09-21'
tags: ['']
draft: false
summary:
---


这两天项目里用到了Mybatis框架的深度定制功能，是关于数据库加解密的。

使用下来的感受就是，框架这件事情本身是很值得讨论的是一件事情。

# 框架本身

首先，防止了反复造轮子这是肯定无疑的，无法否认的“功绩”。在加快开发进度这一块儿没得说。

但是，如果一个框架本体代码是较为庞大的，本身提供的接口比较多（这意味着本身的复杂度就比较高），而文档较为匮乏，那框架的使用者大概率是要重度依赖社区和晦涩的官方文档了。

我觉得设计一个框架很重要的事情，也就是框架设计者需要考虑的一个点是，衡量框架提供的功能丰富度和框架的建议使用程度。

框架本质是，有一群开发者为了减少其他人的开发量，自己制定了一组特定的编码规则，自己制定了一组接口，并且为这种接口的实现提供了额外的编码支持（框架本体）。面临的一个问题就是，如果不去对整套机制进行注释，不去画流程图（即使是抽象的也行），不去对接口中的这些数据结构的字段进行完好的注释，比如改动某些字段意味着什么，那用户拿到这些接口的时候大概率是不知道应该做什么的，使用者大概率是要重度依赖社区和晦涩的官方文档了。

而框架的使用者目的本来是减少开发成本，结果引入框架以后反而引入了一大堆框架本身的复杂度（无论是代码维护本身的，还是代码流程理解的复杂度）。实际上用户是十分痛苦的。

# 框架用户

上面说了，框架用户其实很可能是很痛苦的。因为用户面临的事情是，你框架到底提供了哪些接口（有一个接口列表），有哪些典型用例（其实就是对接口的组合使用），能对业务带来哪些增益（重复代码量减少，整体接口变得更清晰）。

我觉得用户在某些情况下是可以自认倒霉的：
* 使用框架的时候需要逐步debug框架的内部代码去猜测接口或者某个接口参数到底是什么。
* 简单浏览了框架文档之后，看到的框架内部实现的机制太多，仍然不知道该如何使用接口及其参数。
* 接口太多，不知道应该使用哪一种。
这些也可以说是鉴定一个框架是好是坏的一个重要因素。

再来说下我对写一个框架时需要注意的点：
* 不需要暴露的接口不暴露（引入并提高用户使用的复杂度）
* 暴露了的接口必须写好注释，接口+接口参数+使用用例。
* 不该说的内部细节不在文档里体现。（引入并提高用户使用的复杂度）

再说说，如果对于业务上的需求，面对的是一个庞大的框架，在将框架融入到业务上无从下手的时候可以做哪些尝试去自救：
* 查看互联网上特定的业务场景下，框架的用例，这必自己去趟出一条路来要省不少功夫。
* 自己做一个最小的demo，把框架的各种接口放到这个playground里去，自己实地看看接口的参数能提供哪些有用的信息。
* 下下策，就是实再没办法知道框架的某个接口想表达什么，那就只能是debug到框架接口hook，然后寻着调用栈一层一层网上找，栈中自己写的代码为落脚点，看看自己的参数在框架中是怎么流转的，怎么转换到接口参数的。

说实话，一个框架提供的功能越多，我使用起来就越犯怵。
